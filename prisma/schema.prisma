// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  engineType = "library"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/* =========================
   ENUM
========================= */
enum transaction_status {
  PENDING
  PAID
  CANCELED
}

enum payment_method {
  CASH
  TRANSFER
  E_WALLET
}

/* =========================
   USER ROLE
========================= */
model user_role {
  id       String @id @default(uuid())
  roleName String @unique @db.VarChar(50)

  users user[]
}

/* =========================
   USER
========================= */
model user {
  id        String @id @default(uuid())
  username  String @db.VarChar(100)
  email     String @unique @db.VarChar(100)
  password  String @db.Text
  full_name String? @db.VarChar(100)
  phone     String? @db.VarChar(20)
  address   String? @db.VarChar(100)

  userRoleId String
  role       user_role @relation(fields: [userRoleId], references: [id])

  location     location?
  pharmacies   pharmacies[]
  carts        cart[]
  transactions transactions[]
}

/* =========================
   LOCATION
========================= */
model location {
  id        String  @id @default(uuid())
  userId    String  @unique
  latitude  Decimal @db.Decimal(10, 7)
  longitude Decimal @db.Decimal(10, 7)
  updatedAt DateTime @default(now())

  user user @relation(fields: [userId], references: [id])
}


model pharmacies {
  id        String   @id @default(uuid())
  userId    String   @unique
  name      String   @db.VarChar(155)
  address   String   @db.VarChar(255)
  phone     String   @db.VarChar(20)
  latitude  Decimal  @db.Decimal(10, 7)
  longitude Decimal  @db.Decimal(10, 7)
  openTime  String   @db.VarChar(5)   // "08:00"
  closeTime String   @db.VarChar(5)   // "22:00"
  createdAt DateTime @default(now())

  user user @relation(fields: [userId], references: [id])

  medicines    pharmacy_medicines[]
  transactions transactions[]
}

/* =========================
   MEDICINES
========================= */
model medicine {
  id          String   @id @default(uuid())
  name        String
  category    String
  description String?

  pharmacyMedicines pharmacy_medicines[]
  transactionItems  transaction_items[]
  cartItems         cart_items[]
}

/* =========================
   PHARMACY MEDICINES (PIVOT)
========================= */
model pharmacy_medicines {
  id         String @id @default(uuid())
  pharmacyId String
  medicineId String
  stock      Int
  price      Decimal @db.Decimal(10, 2)
  updatedAt  DateTime @default(now())

  pharmacy pharmacies @relation(fields: [pharmacyId], references: [id])
  medicine medicine   @relation(fields: [medicineId], references: [id])

  @@unique([pharmacyId, medicineId])
}


/* =========================
   CART
========================= */
model cart {
  id     String @id @default(uuid())
  userId String
  createdAt DateTime @default(now())

  user user @relation(fields: [userId], references: [id])
  items cart_items[]
}

/* =========================
   CART ITEMS
========================= */
model cart_items {
  id         String @id @default(uuid())
  cartId     String
  medicineId String
  quantity   Int

  cart     cart     @relation(fields: [cartId], references: [id])
  medicine medicine @relation(fields: [medicineId], references: [id])
}


/* =========================
   TRANSACTIONS
========================= */
model transactions {
  id            String @id @default(uuid())
  userId        String
  pharmacyId    String
  totalAmount   Decimal @db.Decimal(10, 2)
  status        transaction_status
  paymentMethod payment_method
  createdAt     DateTime @default(now())

  user       user       @relation(fields: [userId], references: [id])
  pharmacy   pharmacies @relation(fields: [pharmacyId], references: [id])
  items      transaction_items[]
}

/* =========================
   TRANSACTION ITEMS
========================= */
model transaction_items {
  id            String @id @default(uuid())
  transactionId String
  medicineId    String
  quantity      Int
  price         Decimal @db.Decimal(10, 2)

  transaction transactions @relation(fields: [transactionId], references: [id])
  medicine    medicine     @relation(fields: [medicineId], references: [id])
}



